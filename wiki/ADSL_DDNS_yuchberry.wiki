#labels Phase-Deploy
= 配置 ADSL + DDNS 方式的 yuchberry =
<wiki:toc max_depth="2" />

*该方法适用于拥有ADSL拨号上网方式的个人用户使用。*

ADSL 方式可以让用户获得一个Internet广域网地址（如 114.113.56.82 ），但是这个地址经常变动，用户拨号一次，基本上就会变动一次，所以需要配合DDNS（Dynamic Domain Name System 动态域名解析）来保证客户端始终能找的到服务器，并与其维持链接，从而实现邮件的推送。

 == 配置服务器 ==
      # 通过ADSL拨号上网，并且知道[http://www.ip138.com 自己的地址]。如果用户使用的是家庭SOHO路由器（就是100多块钱的货），那么需要访问路由器知道自己的IP地址。（如 114.113.56.82 ）<br />
      # 可选。建议使用DDNS 服务对这个动态分配的IP地址进行解析，以保证可以用一个不变的域名（如 yuchberry.gicp.net ），代替动态的IP访问到服务器。国内的DDNS比较出名的有 [http://www.oray.com/peanuthull/ 花生壳] 等（我就是用的这个），首选他的主要原因是因为路由器可以配置，自动进行登录解析，不需要在服务器上进行安装。可以[http://www.google.com.hk/search?sourceid=chrome&ie=UTF-8&q=%E5%8A%A8%E6%80%81%E5%9F%9F%E5%90%8D 搜索 "动态域名" ]获得更多信息。具体图文配置看[http://code.google.com/p/yuchberry/wiki/Router_DDNS_Config 这里]。<br />
      # 如果是直接电脑拨号上网（就是每次上网前必须点击拨号），请暂时跳过此步。使用路由器的端口映射机制映射一个端口给服务器，这个端口自己制定，比如 9716 ，这个值从3000 到 65535，不要与其他服务相重合。具体帮助请搜索 “[http://www.google.com.hk/search?sourceid=chrome&ie=UTF-8&q=BT+%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84 路由器端口映射]”，同时[http://www.t1shopper.com/tools/port-scan/ 这里]可以测试是否打开端口。<br />
      # 下载[http://www.java.com/zh_CN/download/manual.jsp Java Runtime Environment 5.0(以上) （jre）]，并进行安装。如果你已经有了Jre，就不需要安装了。判断方法（Windows平台下） ：
       # 开始 -> 运行 -> 输入 cmd -> 输入 java ，如果出现的是一大串英文，而不是“不是内部文件”之类的提示，那么就已经装上了某个版本的java
       # 然后再输入 java -version 如果出现 1.5.x（或者更高版本） 的数字字样，那么就符合要求，不然就需要去重现下载安装。<br />
      # [http://code.google.com/p/yuchberry/downloads/list 下载]yuchberry服务器程序到计算机上，解压缩到一个文件夹里面。<br />
      # 打开config.xml文件，进行配置，具体的配置看[http://code.google.com/p/yuchberry/wiki/fill_config_ini 这里]。
       * 输入"用户密码"的时候，要记住，客户端需要用的上。
       * “yuchberry server 端口” 需要填入在前面“路由器端口映射”所分配的端口。（例如 9716）
       * 如果是Windows ，请确保防火墙允许这些端口进行连接。具体步骤帮助，请搜索“windows防火墙例外”。<br />
      # 双击runSvr.bat，运行服务器程序，如果出现"prepare account OK"字样，祝贺你，服务器配置成功了。其他运行方式请看[http://code.google.com/p/yuchberry/wiki/run_server_bat 这里]<br />
      # 检查端口是否打开。到[http://www.t1shopper.com/tools/port-scan/ 这里]输入你的IP地址(如果你是花生壳域名，需要用ping命令解析一下域名)和配置的端口，检查是否打开，如果没有打开，检查之前的步骤是否有问题。<font color="red">很多问题都是端口没有打开导致的。</font><br />
      # 如果出现问题，请到[http://code.google.com/p/yuchberry/wiki/Connect_Error_info#服务器条目 这里]排查问题所在。

 == 配置客户端 ==
      # 首先要确认自己的手机上面的Service Book是否含有 <font color="red">*CMIME条目*</font>，如果没有，需要到网上搜索一个合适的带有CMIME 的Service Book，也可以去[http://code.google.com/p/yuchberry/downloads/list 这里]下载一个网上流传已久的6项的Service Book。<br />
      # 去看看自己黑莓机器的[http://code.google.com/p/yuchberry/wiki/OS_Model 型号对照表]，然后去[http://code.google.com/p/yuchberry/downloads/list 下载]客户端到电脑，通过 Desktop Manager 安装。<br />
      # 检查是否能发邮件。就是在短信界面，点击黑莓菜单键，看看是否有“编写电子邮件”一项，如果没有，那么到[http://code.google.com/p/yuchberry/wiki/Service_Book 这个页面]去详细阅读，并安装一个正确的Service Book。<br />[http://i.imgur.com/vdj3U.gif]<br /><br />
      # 填写“主机”。
       # 如果你是使用主机直接拨号上网的话，填入你之前查询的IP地址（如 114.113.56.82 ）
       # 如果你使用的是[http://www.google.com.hk/search?rlz=1C1GPEA_enCN394CN394&sourceid=chrome&ie=UTF-8&q=%E5%8A%A8%E6%80%81%E5%9F%9F%E5%90%8D 动态域名]的话，请填写上动态域名，（例如花生壳是 yuchberry.gicp.net）<br />
      # 填写端口。在服务器配置的步骤中，有一个端口映射所分配的端口，前面的例子是 9716。<br />
      # 填写用户密码。这个在config.xml文件中自己设置过，应该很熟悉了吧，填上。<br />
      # 填写APN。如果你用手机打开浏览器上网的时候很流畅，没有什么问题，可以缺省的不用填写。如果你用的是中国联通gprs（我就是），同时上网的时候时好时坏，那么有必要看看[http://code.google.com/p/yuchberry/wiki/fill_APN 这篇文章]，填写合适的APN，将会大大提高连接成功率。<br />
      # 选择SSL。可以留空。这个需要服务器配合，在如何配置更加安全的SSL链接文章中，有解释如何使用yuchberry配置SSL。

    == 连接测试 ==
        
      以上两个工作做完之后，保证服务器开启，就可以测试了，客户端点击“Connect”按钮，这个时候，如果底下的状态字符串显示 connected，那么就表示链接上了。返回桌面的时候，发现YuchBerry 的图标从黑白变成彩色。

   http://i.imgur.com/vdj3U.gif
   http://imgur.com/wmtFS.jpg

      连接上以后，服务器程序会扫面邮件服务器中最近的50封邮件中没有打开阅读过的邮件。推送到手机端。

      给自己的邮箱发送一封邮件吧，看看速度有多快？

      如果有配置上的任何问题，yuchberry 连接不上，可以在主界面点击黑莓菜单键，选择<font color="red">诊断信息</font>，yuchberry 有错误信息输出，可以到[http://code.google.com/p/yuchberry/wiki/Connect_Error_info 这个页面]查找到相关信息的解释，也可以到[http://code.google.com/p/yuchberry/issues/list Issues页面]查找这个问题是否有他人已经遇到过，当然，也可自己提问。

      <b> 注意!</b> 之前的alpha测试发现，手机端的其他邮件客户端* 可能会* 对yuchberry的时候产生影响，所以，如果无法连接、收信、发信，可以先试着将其他的客户端（已经专有Service Book），卸载之后再重新连接测试，可能会顺利。

 == 使用指南 ==
        在[http://code.google.com/p/yuchberry/wiki/Use_introduction 这个页面]。