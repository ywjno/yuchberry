= Weibo模块的配置和使用 =
<wiki:toc max_depth="3" />
   在1.1.715（不含）之后的语盒版本中，除了改进之前的PushMail功能之外，还集中开发了统一Weibo的模块。原因没什么，只是想做，不为别的。

   现在写这篇文档的时候YuchWeibo还没有发布，即便是过阵子发布了，这篇文档也有可能在今后的修复开发中，和实际的产品不一致——要知道，我只有一双手，十个指头，难免会有偏差，敬请谅解。

 == 配置客户端 ==
    打开客户端Weibo模块很简单，在 *高级设置* 里面勾选中* 开启Weibo模块* ，就可以开启了。开启后，在*语盒账户状态* 的界面中就会有*Weibo* 的菜单选贤点击就可以打开Weibo管理界面。<br />
    [http://clip2net.com/clip/m85555/thumb640/1308455644-snap0-19kb.png][http://clip2net.com/clip/m85555/thumb640/1308455809-snap0-03-16kb.png]
    [http://clip2net.com/clip/m85555/thumb640/1308455880-snap0-02-26kb.png]
    [http://i.imgur.com/Bhd7F.jpg]<br />
    * <b>开启Weibo模块</b>
     启用后，weibo模块就开启，进入语盒的首次界面就不是*语盒账户状态* 了，而是Weibo界面，需要通过菜单才能进入 *语盒账户状态* 。
    * <b>转发/评论后同时发一条Weibo</b>
    * <b>回复后同时发一条Weibo</b>
     Sina Weibo等国内Weibo对于这条选项来说有用，T Weibo所以的转发、回复都会在自己Timeline上发一条Weibo
    * <b>优先显示评论原始内容</b>
     Sina Weibo等国内Weibo对于这条选项来说有用，就是把原始内容优先显示，再显示评论的内容，方便黑莓屏幕查看，不然首先看到评论，但是不知道他评论的是什么，心里有些纳闷。
    * <b>跨Weibo转发</b>
     这个会在你转发、评论一条微博的时候，在自己所有的推送Weibo账户上显示出来，比如你在 T Weibo 上看到一个好笑的笑话，转发一下，那么你在 Sina Weibo 的推送账户上也会出现这条Weibo的内容。

  ===快捷键===
    由于屏幕的限制，Weibo查看有一定的限制，使用快捷键会大大加快查看、发表Weibo的速度。
     * <b>T</b> 快速回到最顶端
     * <b>空格</b> 在查看Weibo状态下，迅速查看下一个Weibo
     * <b>0</b> 在查看Weibo状态下，迅速查看上一个Weibo
     * <b>F</b> 在查看Weibo状态下，转发
     * <b>E</b> 在查看Weibo状态下，@博主
     * <b>V</b> 在查看Weibo状态下，收藏
     * <b>G</b> 在查看Weibo状态下，查看图片

  ===其他说明===
    在语盒统一 PushWeibo 里面，<b>转发就是评论，@就是回复</b>，也许这个一开始不太适应，但是作为一个款能够推送很多类型的Weibo软件来讲，这种简单的合并就是去简化大量的操作，带给用户明确而简单操作方式，而并非复杂化。

 == 服务端配置 ==
   直到我写这篇文档的时候，仅仅集成了 Sina Weibo 和 T Weibo 还有 QQ Weibo，今后可能会加入更多的Weibo进来，但是配置几乎是相同的，正所谓“天下武功出少林”，这个道理在Weibo界也是相同的——大家都是使用的xAuth来授权，所以只介绍QQ Weibo的配置。
  
  === 自架服务器配置 ===
  * 获得授权码 
   * 网页授权
    <b>建议使用网页授权获得授权码，直接访问 [http://api.yuchs.com/passgen.html http://api.yuchs.com/passgen.html]</b>
   * 本地授权
    在服务器发行版本里面有一个名为 weiboTool_sina.bat 的文件，双击它，会出现下面的界面。GNU/Linux下面需要有 XWindow 的支持，因为要打开浏览器。<br />
    此时需要java运行时环境，如果在自己机器上没有安装jre的，请到[http://www.java.com/zh_CN/download/manual.jsp 这里下载jre]。<br />
    [http://img4.hostingpics.net/pics/446645capture1308206622.jpg]<br />
    浏览器会自动打开，然后输入帐号，或者允许授权<br />
    [http://img4.hostingpics.net/pics/201425capture1308206698.jpg]<br />
    完成后，浏览器会自动跳转到一个语盒的页面，这个页面时刚才的那个黑色窗口服务的，会看到如下页面 <br />
    [http://i.imgur.com/DGxVM.jpg]<br />
    这个时候授权就已经完成了，获得可以访问账户的 * 访问令牌* ，语盒Weibo 只会使用安全的 OAuth 访问Weibo账户，不会泄漏用户的密码和信息。你还可以深入了解[http://zh.wikipedia.org/wiki/OAuth 什么是OAuth]。
  * 填写config.xml配置文件
    * <b>配置Tag</b>
     通过上面获得 *访问令牌* 之后，就可以填写 config.xml 配置文件了，新加了一组以   *WeiboAccount* 的Tag，里面通过 *type* 属性来区分类型，现在有 *sina* *tw* *qq* 几种类型，之后可能会加入更多的Weibo Type。上面获得的令牌（Token）填写如下：
    {{{
<?xml version="1.0" encoding="UTF-8"?>
<Yuchberry userPassword="111111" serverPort="9716" pushInterval="10" userSSL="0" convertoSimpleChar="0" >

       ...

      <WeiboAccount
		type="qq"
		account="yuchberry"		
		accessToken="d7804a95bde0436ca9f0b62ef8******"
		secretToken="0a076b55a89ed75bada75b72d880a60b"
		
		
		timelineSum="20"
		directMessageSum="5"
		atMeSum="5"
		commentSum="5"
	/>
       ...
/>
    }}}
    config.xml 主要属性配置（推送端口、轮训间隔等等），和PushMail配置在[fill_config_ini 这里]。<br />
    <b>极度注意:</b> 这里的从理论上来讲，语盒支持多个相同的 *type* WeiboAccount标签（也就是说推送多个SinaWeibo账户），但是在真正使用的时候，比如回复、转发、评论等等会有一些意想不到的误解，所以不建议使用多个相同 *type* WeiboAccount标签。
    * <b>配置Tag 属性</b>
    解释一下标签里面的属性的含义：<br>
     * *account*          账户名
    这个账户名的属性其实是无所谓的，因为用于访问微博的两把钥匙你都已经得到了，就可以访问你的微博账户信息了，这个account属性是语盒服务器用来标识自己多个Tag的，只要各个Tag的account属性字段不要重复就行了。<br />
     * *timelineSum*      主页
     * *directMessageSum* 私信
     * *atMeSum*          @到我的
     * *commentSum*       评论到我的
    语盒的机制永远不会改变：服务器轮训，及时推送到客户端（原理视频在[http://code.google.com/p/yuchberry/wiki/FAQ#原理解说视频 这里]）。但是由于Weibo的特殊性：主页Weibo数量较多，回复、评论到我的Weibo对于每一个人来说又不一样，又要保证手机端达到省电、省流量的目的，还要保证Weibo快捷的推送到，于是使用一种算法来实施这个特殊的Weibo推送：<br>
     <b>推送时机 ：轮训次数 + Weibo数量 >= Sum属性的值</b><br>
    举个例子，如果设置 timelineSum="20"，当前已经轮训3次，只有累计Weibo达到或者超过 17个的时候，才能触发一次推送，把17个Weibo集中起来，压缩，一次性推送给客户端；否则，继续轮训，直到它们的和超过指定的 Sum 值。<br />
    当然，还有一个普遍规律适用：* 如果你弄不清楚什么意思，那就是用默认的值吧* 。<br />
    * <b>手动刷新</b> 
    只需要将其上面的字段填为负值即可，比如<br>
     <b>timelineSum=-30</b>  <br>
    就是服务器不会主动推送主页的Weibo，要等到客户端请求才会推送，推送最近的、不重复的30条Weibo。

 

    