= yuchberry 客户端使用说明 =

之前由于疏忽了，所以没有写使用教程是在是……一款良好的软件怎么能没有使用说明呢？

发送信件需要安装网上通用的Service Book，我对Service Book的探索还刚刚开始，具体可以看看[http://code.google.com/p/yuchberry/wiki/Service_Book 这里]。


== 收取信件 ==

  * 由于yuchberry是使用的集成邮件方式，自身是没有相关界面的，自身的界面是配置和yuchberry服务器连接各种参数。收到信后，会放入系统消息里面，并用固定的铃声和LED闪烁提示用户收到信了，同时在主屏幕上出现提示，如下图：

         [http://imgur.com/wmtFS.jpg]

  * 当你打开一封信件的时候，会通知yuchberry服务器，说这封信已经打开过，同时在邮件服务器上标记为已读。

         [http://imgur.com/dgprZ.jpg]

  * HTML 邮件会通过附件的形式发送过来，但是附件无法启动浏览器，于是yuchberry会把HTML的所有文本信息和链接信息都会以纯文本形式复制到这封邮件中。
   [http://imgur.com/Vq81s.jpg]

   HTML 附件查看
   
   [http://imgur.com/pJ9wF.jpg]

   邮件正文中的长URL地址会被缩短为短地址，仍然是有效的，通过点击可以通过内置浏览器打开。

   [http://imgur.com/wHoRE.jpg]

  * 附件接收。yuchberry当然是能够接受附件的，当你收到附件的时候，点击附件，选择“YuchBerry 打开附件”。这个时候需要保证你的SD卡可用，不然会出现“文件系统错误”的提示。

   [http://imgur.com/UzKtS.jpg][http://imgur.com/MWNJr.jpg]

  点击后yuchberry会在后台下载附件，继续点击“YuchBerry 打开附件”会告诉现在的进度。附件会默认下载SD卡下面的 YuchBerry/AttDir 文件夹下。如果有同名附件文件，会覆盖。

   [http://imgur.com/3R6dT.jpg]

  下载完成后，会弹出对话框，通知你是否查看附件，点击确认后，可以通过yuchberry文件查看器查看到附件。

   [http://imgur.com/spyCh.jpg]

  yuchberry文件查看器附件支持的类型有：
   # 文本文件：txt log dic 格式 （查看容量为 5KB，仅仅是查看，附件文件是完整的）
   # 图像文件：jpg bmp gif png 格式
   # 视频文件：3gp mp4 格式

   其他格式文件可以自行打开。

== 发送信件 == 

  * 首先要保证yuchberry是打开着的，也就是要点击过yuchberry“连接”按钮，连接状态可以是“连接成功”或者是“重连中”，到消息界面点击“编写电子邮件”。

   [http://imgur.com/KH1i8.jpg][http://imgur.com/QV0W0.jpg]

  * 添加附件。点击菜单键，“YuchBerry 添加附件”后会进入文件选择界面，可以选择任意你想发送的附件。也可以点击“Check”进行查看。

   [http://imgur.com/68FPv.jpg][http://imgur.com/TYpxk.jpg]

  * 查看删除附件。点击“YuchBerry 查看附件”，会有已经添加的附件，可以点击，选择“OK”，删除之。

   [http://imgur.com/WKw4K.jpg]

  * 发送。点击“发送”后就会发送邮件，如果是不带附件的话，不久将会发送成功，图标显示下图所示。

   [http://imgur.com/TIf3W.jpg][http://imgur.com/Ugsxh.jpg]

  如果发送带有附件的邮件，进度会比较漫长，也可以到yuchberry主界面中查看进度。

   [http://imgur.com/TKElc.jpg]

  打开自己的邮箱，就能查看到刚才所发送的邮件了。

   [http://imgur.com/qL0rm.jpg]

==高级设置==

    [http://i.imgur.com/FpKPe.png]

  * 访问点APN 
  * 链接后缀 
  详细见[http://code.google.com/p/yuchberry/wiki/fill_APN 这里]
  
  * 心跳间隔 
  如果仔细观看[http://code.google.com/p/yuchberry/wiki/FAQ FAQ页面]下面的原理讲解视频，就会知道心跳间隔是什么意思了。我再简单说一下：<br/>
  GPRS的网络如果不是专有通道，那么一个IP地址会被很多个手机共享，指不定你和yuchberry服务器的链接就断开了，而服务器和客户端都不知道这个问题，认为还是连通的（这个就是基站路由器的算法了）。所以需要发送TCP链路包，让手机通过强制确认，知道这个链路是链接着的，这个就叫做pulse，心跳。<br/>
  心跳包间隔越长，那么基于GPRS的TCP链路连接性就越强，但是手机越耗电，所以需要确认自己需要多强的连接性去即时的收取邮件。同样的道理，如果所处的地区移动运营商的GPRS网络很稳定，IP地址不会常常发生改变，那么使用长的间隔也会保证TCP链路较为稳定，手机更加省电。<br/>
  所以基于专有GPRS通道的BES、BIS，做到既省电又能保证邮件即时到达的根本原因便在于此。
  * 使用SSL
  详细见[http://code.google.com/p/yuchberry/wiki/SSL_yuchberry 这里]
  * 考虑使用MDS
  默认是不选择的，只使用TCP，不选择MDS；如果选择，就会在MDS存在的情况下走MDS网络，当然，系统会判断，如果没有MDS，就选择TCP直接连接。[http://www.google.com.hk/search?hl=zh-CN&newwindow=1&safe=strict&q=MDS+Blackberry&aq=f&aqi=g10&aql=&oq= 什么是MDS]
  * 使用WIFI
  由于本人只有8310，所以wifi是测试不到了，但是按照开发文档的说明，我加上了功能。上天保佑，它能用。
  * 开机自动连接
  不说是啥了，字面意义理解就行。

     [http://i.imgur.com/rVlVZ.jpg]

  * 流量统计
   * 这个需要重点说明一下，由于不知道GPRS流量计算使用的是底层数据链路的流量，还是使用上层IP层的数据，所以无法十分精确。yuchberry使用的流量统计是后者：IP层的数据包的长度。但是这个也是不准的，比如connect 的3次连接包是否会邮箱，如果在建立连接的是时候，GPRS断掉了，那这个流量是否会计算？这个都是未知数。<br/>
   * 还有一点需要说明，这个流量统计在是SSL的时候更加不准确，我无法预知我发出去的明文包在底层加密的长度，所以SSL实际使用流量会比显示数量稍大。<br/>
   * 计算出来的流量是经过压缩处理的包的流量，如果加载一个压缩率非常高的附件800KB，可能压缩成100KB，那么你下载完附件之后，实际下行流量消耗为100KB，所以不要认为这个是Bug<br />
  * 提醒选项
  在alpha和beta版本的时候，由于自己是黑莓开发新手，所以没有做到情景模式中，现在的提醒配置都写在了黑莓的情景配置里面了。
   # 全天提醒。如果你想在凌晨1点收到邮件的时候，也听到铃声，就勾选上这个吧。我有一次睡的正酣，突然手机收到邮件了，把我振醒了，那是一封垃圾邮件，于是我就加上这个功能了。
   # 提醒（开始、结束）时间。如果没有选择全天提醒，那么这个就是需要提醒的时间段。

      [http://i.imgur.com/EvP8x.jpg]

  * 位置信息（只能使用GPS）
  由于没有移动塔台（基站）、wifi的位置信息，所以只能使用手机内置的AGPS模块来获得准确的位置。如果你的经纬度如图不为0，那么就会将自己的位置信息发送给你的邮件接收方。具体位置信息看[http://code.google.com/p/yuchberry/wiki/Location_Mail 这里]。

==发送原理==

 由于Yuchberry是外挂于RIM OS的，所以在发送过程中的任何一个阶段出了问题，都会使得发送过程异常，出现总是“发送状态，但是信件已经发送完毕”、“发送邮件太慢”之类的问题，鉴于此，我制作了一个简单原理图，有助于大家理解Yuchberry的外挂机制，和排查问题。

_ 下图由 [http://www.gliffy.com/ Gliffy] 制作 _

[http://www.gliffy.com/pubdoc/2604612/L.png]

 * <font color="red">1、没有通知</font>
  一些系统中装有其他的邮件客户端，可能导致系统不通知Yuchberry，用户已经点击“发送”菜单，已经发送了一封邮件。<br />判断是否是这个问题的方法是：进入Yuchberry客户端“诊断信息”界面，看是否有 "sendMsg" 的提示，如果没有，那么请查看一下是否有其他客户段的影响。

 * <font color="red">2、系统处理X</font>
  系统会根据当前的Service Book对“发送”指令的响应，如果所安装的Service Book中的CMIME条目中有上了RIM服务的条目和其他异常条目（CMIME不是无效的条目，只有无效的条目才行），那么这个红色的“X”设置就会出错，变成“正在等待”的状态，或者其他状态，导致yuchberry在设置邮件状态的时候出错。当然，这个问题只是现实问题。

 * <font color="red">3、连接断开、速度过慢</font>
  因为使用的是公共GPRS通道（便宜），而不是RIM的专用GPRS通道（昂贵），yuchberry客户端和服务器之间随时都有可能断开，只要断开，他们发送就会失败。yuchberry正因为发现这个原因，所以有“没有收到确认消息，重新发送，尝试3次”的机制，这个机制会导致，发送多个邮件，但是至少减少了发送失败的可能性。<br />在共用GPRS通道中传递消息，除了丢失发送的数据包之外，还有一个问题就是速度过慢，如何判断这个速度的问题，可以从服务器的日志上的收到客户端消息，发送，再到确认的时间戳，就知道哪里拖慢了发送邮件的速度。

 * <font color="red">4、连接断开、速度过慢、账户出错</font>
  当然，这个出现错误的可能性很小，因为它是服务器与服务器之间的连接。排查错误也是需要通过Yuchberry服务器的日志来看。
